<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recreation.gov Booking Bot</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/main.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <!-- Top Navigation Bar -->
    <header class="top-nav-bar">
        <div class="top-nav-content">
            <h1 class="app-title">üé´ Recreation.gov Booking Bot</h1>
            <div class="top-nav-actions">
                <button class="btn-secondary btn-sm" onclick="openConfigModal()">‚öôÔ∏è Settings</button>
                <!-- Password Save Status (Main Screen) -->
                <div class="connection-status">
                    <span class="status-indicator" id="statusIndicator"></span>
                    <span id="statusText">Checking...</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Main Layout: Sidebar + Calendar -->
        <div class="calendar-layout">
            <!-- Left Sidebar with Mini Calendar -->
            <aside class="left-sidebar">
                <div class="mini-calendar-container">
                    <div class="mini-calendar-header">
                        <button type="button" class="mini-nav-btn" id="miniCalendarPrevBtn" aria-label="Previous month">‚Äπ</button>
                        <h3 id="miniCalendarTitle">Month Year</h3>
                        <button type="button" class="mini-nav-btn" id="miniCalendarNextBtn" aria-label="Next month">‚Ä∫</button>
                    </div>
                    <div id="miniCalendar" class="mini-calendar"></div>
                </div>

                <!-- Scheduled Bookings List -->
                <div class="sidebar-bookings-container">
                    <h3 class="sidebar-bookings-title">Scheduled Bookings</h3>
                    <div id="sidebarBookingsList" class="sidebar-bookings-list">
                        <p class="empty-state">No scheduled bookings</p>
                    </div>
                </div>
            </aside>

            <!-- Main Calendar Area -->
            <main class="main-calendar-area">
                <!-- Calendar Card -->
                <section class="card calendar-card">
                    <div class="calendar-header">
                        <button type="button" class="btn-secondary btn-icon" id="calendarPrevBtn" aria-label="Previous month">‚Äπ</button>
                        <h2 id="mainCalendarTitle">November 2025</h2>
                        <button type="button" class="btn-secondary btn-icon" id="calendarNextBtn" aria-label="Next month">‚Ä∫</button>
                    </div>
                    <div id="calendar"></div>
                </section>
            </main>
        </div>

        <!-- Booking Side Panel (Google Calendar style) -->
        <div id="bookingSidePanel" class="side-panel">
            <div class="side-panel-content">
                <div class="side-panel-header">
                    <h2 id="sidePanelTitle">New Booking</h2>
                    <button type="button" class="side-panel-close" onclick="closeBookingSidePanel()" aria-label="Close">&times;</button>
                </div>
                <form id="bookingForm">
                    <!-- Hidden fields -->
                    <input type="hidden" id="url" name="url">
                    <input type="hidden" id="email" name="email">
                    <input type="hidden" id="password" name="password">
                    <input type="hidden" id="bookingDate" name="bookingDate">

                    <!-- Selected Date Display -->
                    <div class="side-panel-date-display">
                        <span class="date-icon">üìÖ</span>
                        <span id="selectedDateDisplay">No date selected</span>
                    </div>

                    <!-- Time Slots (First) -->
                    <div class="form-group">
                        <label>Time Slots *</label>
                        <small class="slot-help">Select time slots and specify quantity for each</small>
                        <div id="timeSlotsGrid" class="time-slots-grid">
                            <!-- Time slots will be generated by JavaScript -->
                        </div>
                    </div>

                    <!-- Trigger Date & Time (Second) - Single Formatted Input -->
                    <div class="form-group">
                        <label for="triggerDateTime">Trigger Date & Time *</label>
                        <input type="text" id="triggerDateTime" name="triggerDateTime" required
                            placeholder="DD/MM/YYYY HH:MM" maxlength="16"
                            autocomplete="off">
                        <small>Enter date and time (e.g., 25/12/2025 14:30). Just type the numbers - formatting is automatic!</small>
                        <small id="triggerDateTimeError" class="error-message" style="display: none;"></small>
                    </div>
                    <!-- Hidden field to store backend-formatted datetime -->
                    <input type="hidden" id="triggerDateTimeFormatted" name="triggerDateTimeFormatted">

                    <!-- Submit Button (Third) -->
                    <button type="submit" class="btn-primary btn-large" id="submitBtn">
                        Activate Booking
                    </button>
                </form>
            </div>
        </div>

        <!-- Event Details Panel -->
        <div id="eventDetailsPanel" class="side-panel">
            <div class="side-panel-content">
                <div class="side-panel-header">
                    <h2>Booking Details</h2>
                    <button type="button" class="side-panel-close" onclick="closeEventDetailsPanel()" aria-label="Close">&times;</button>
                </div>
                <div id="eventDetailsContent">
                    <!-- Content populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Event Hover Tooltip -->
        <div id="eventTooltip" class="event-tooltip" style="display: none;">
            <div id="tooltipContent"></div>
        </div>

        <!-- Side Panel Overlay -->
        <div id="sidePanelOverlay" class="side-panel-overlay" onclick="closeAllPanels()"></div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Configuration Modal -->
    <div id="configModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Configuration Settings</h2>
                <button class="modal-close" onclick="closeConfigModal()">&times;</button>
            </div>

            <!-- WebSocket Connection Status (Settings Page) -->
            <div class="config-bot-status">
                <span class="bot-status-indicator" id="botStatusIndicator"></span>
                <span class="bot-status-text" id="botStatusText">Checking connection...</span>
            </div>

            <form id="configForm">
                <div class="form-group">
                    <label for="configEmail">Email Address</label>
                    <input type="email" id="configEmail" name="email" placeholder="your@email.com">
                    <small>Your recreation.gov login email (auto-fills booking form)</small>
                </div>

                <div class="form-group">
                    <label for="configPassword">Password</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="configPassword" name="password" placeholder="Your password">
                        <button type="button" class="password-toggle"
                            onclick="togglePasswordVisibility('configPassword')"
                            aria-label="Toggle password visibility">
                            <svg class="eye-icon eye-open" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            <svg class="eye-icon eye-closed" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                style="display: none;">
                                <path
                                    d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24">
                                </path>
                                <line x1="1" y1="1" x2="23" y2="23"></line>
                            </svg>
                        </button>
                    </div>
                    <small>Your recreation.gov password (stored securely)</small>
                </div>

                <div class="form-group">
                    <label for="configDefaultUrl">Default URL</label>
                    <input type="url" id="configDefaultUrl" name="default_url"
                        placeholder="https://www.recreation.gov/ticket/233338/ticket/10089777">
                    <small>Default recreation.gov ticket URL (auto-fills booking form)</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="configMonitoringTime">Slot Monitoring Time (minutes)</label>
                        <input type="number" id="configMonitoringTime" name="slot_monitoring_time" min="1" max="120"
                            value="30">
                        <small>How long to monitor for slot availability</small>
                    </div>

                    <div class="form-group">
                        <label for="configMonitoringInterval">Monitoring Interval (ms)</label>
                        <input type="number" id="configMonitoringInterval" name="monitoring_interval" min="10"
                            max="1000" value="50">
                        <small>How frequently to check for slots</small>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeConfigModal()">Cancel</button>
                    <button type="button" class="btn-danger" onclick="clearConfiguration()">Clear All</button>
                    <button type="submit" class="btn-primary">Save Configuration</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
    <script src="/static/js/app.js"></script>
</body>

</html>